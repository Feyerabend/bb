<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Virtual Keyboard - Typewriter Style</title>
    <style>




        /* Optional: make the stagger feel more natural on wider screens */
        @media (min-width: 600px) {
        .row-2 { padding-left: 34px; }
        .row-3 { padding-left: 68px; }
        }


        body {
            font-family: Arial, Helvetica, sans-serif;
            max-width: 960px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        h1 { text-align: center; color: #333; }

        #input-area {
            width: 100%;
            min-height: 90px;
            margin: 20px 0;
            padding: 14px;
            border: 2px solid #ccc;
            border-radius: 8px;
            font-size: 19px;
            line-height: 1.4;
            outline: none;
            background: white;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        #input-area:focus {
            border-color: #007bff;
            box-shadow: 0 0 0 4px rgba(0,123,255,0.2);
        }

        .keyboard {
            display: flex;
            flex-direction: column;
            gap: 8px;               /* vertical spacing between rows */
            margin: 30px auto;
            max-width: 920px;
            user-select: none;
        }

        .keyboard-row {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;        /* fallback in case it gets too narrow */
            justify-content: center;
        }



        .row {
            display: contents; /* allows row-level transform */
        }

        .key {
            height: 52px;
            background: #f5f5f5;
            border: 1px solid #bbb;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 17px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.12s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.12);
        }

        .key:hover    { background: #e8e8e8; transform: translateY(-1px); }
        .key:active   { background: #d8d8d8; transform: translateY(1px); box-shadow: none; }

        /* Highlight when physical key is pressed */
        .key.active {
            background: #007bff !important;
            color: white !important;
            box-shadow: 0 0 12px rgba(0,123,255,0.7);
            transform: scale(1.08);
        }

        /* Staggering (typewriter style) */
        .row-1 { transform: translateX(0px); }     /* top row (numbers would be here) */
        .row-2 { transform: translateX(20px); }    /* QWERTY row */
        .row-3 { transform: translateX(38px); }    /* ASDF row - home row */
        .row-4 { transform: translateX(58px); }    /* ZXCV row */

        /* Special wider keys */
        .key.space { grid-column: span 7; font-size: 15px; }
        .key.backspace { grid-column: span 2; background: #ffe0e0; font-size: 15px; }
        .key.enter { grid-column: span 3; background: #e0ffe0; font-size: 15px; }

        #send {
            padding: 14px 40px;
            font-size: 17px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 20px auto;
        }
        #send:hover { background: #0062cc; }
    </style>
</head>
<body>

<h1>Virtual Typewriter Keyboard</h1>

<div id="input-area" contenteditable="true" spellcheck="false"></div>

<!-- HTML structure change (remove display:contents rows) -->
<div class="keyboard">
  <!-- Row 1: QWERTY row (shifted left) -->
  <div class="keyboard-row row-1">
    <div class="key" data-key="Q">Q</div>
    <div class="key" data-key="W">W</div>
    <div class="key" data-key="E">E</div>
    <div class="key" data-key="R">R</div>
    <div class="key" data-key="T">T</div>
    <div class="key" data-key="Y">Y</div>
    <div class="key" data-key="U">U</div>
    <div class="key" data-key="I">I</div>
    <div class="key" data-key="O">O</div>
    <div class="key" data-key="P">P</div>
    <div class="key backspace" data-key="Backspace">← Backspace</div>
  </div>

  <!-- Row 2: ASDF row (home row - less shift) -->
  <div class="keyboard-row row-2">
    <div class="key" data-key="A">A</div>
    <div class="key" data-key="S">S</div>
    <div class="key" data-key="D">D</div>
    <div class="key" data-key="F">F</div>
    <div class="key" data-key="G">G</div>
    <div class="key" data-key="H">H</div>
    <div class="key" data-key="J">J</div>
    <div class="key" data-key="K">K</div>
    <div class="key" data-key="L">L</div>
  </div>

  <!-- Row 3: ZXCV row + wide space + enter (most shift) -->
  <div class="keyboard-row row-3">
    <div class="key" data-key="Z">Z</div>
    <div class="key" data-key="X">X</div>
    <div class="key" data-key="C">C</div>
    <div class="key" data-key="V">V</div>
    <div class="key" data-key="B">B</div>
    <div class="key" data-key="N">N</div>
    <div class="key" data-key="M">M</div>
    <div class="key space" data-key=" ">Space</div>
    <div class="key enter" data-key="Enter">↵ Send</div>
  </div>
</div>

<button id="send">Send to Server</button>

<script>
const input = document.getElementById('input-area');
const sendButton = document.getElementById('send');
const keys = document.querySelectorAll('.key[data-key]');

// Focus on load
input.focus();

// Virtual clicks
keys.forEach(key => {
    key.addEventListener('click', () => {
        const value = key.dataset.key;
        if (value === 'Backspace') {
            document.execCommand('delete', false, null);
        } else if (value === 'Enter') {
            sendData();
        } else {
            document.execCommand('insertText', false, value);
        }
        input.focus();
    });
});

// Physical keyboard + highlight
document.addEventListener('keydown', e => {
    if (e.ctrlKey || e.metaKey) return;

    const keyEl = [...keys].find(k => {
        const dk = k.dataset.key;
        return dk === e.key.toUpperCase() || 
               (dk === ' ' && e.key === ' ') ||
               (dk === 'Enter' && e.key === 'Enter') ||
               (dk === 'Backspace' && (e.key === 'Backspace' || e.key === 'Delete'));
    });

    if (keyEl) {
        keyEl.classList.add('active');
        setTimeout(() => keyEl.classList.remove('active'), 180);
    }

    if (e.key === 'Enter') {
        e.preventDefault();
        sendData();
    }
});

document.addEventListener('keyup', e => {
    const keyEl = [...keys].find(k => k.dataset.key === e.key.toUpperCase() || 
                                  (k.dataset.key === ' ' && e.key === ' '));
    if (keyEl) keyEl.classList.remove('active');
});

// Send logic (same as before)
async function sendData() {
    const text = input.textContent.trim();
    if (!text) return alert('Nothing to send!');

    try {
        const sharedKey = 'mysecretkey12345';
        const encrypted = await encryptData(text, sharedKey);

        const response = await fetch('http://your-pico-server-ip:80/keystrokes', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ encrypted })
        });

        if (!response.ok) throw new Error('Server error');

        alert('Sent successfully!');
        input.textContent = '';
        input.focus();
    } catch (err) {
        alert('Error: ' + err.message);
    }
}

async function encryptData(plaintext, key) {
    const enc = new TextEncoder();
    const encoded = enc.encode(plaintext);
    const iv = crypto.getRandomValues(new Uint8Array(12));
    
    const cryptoKey = await crypto.subtle.importKey(
        "raw", enc.encode(key), { name: "AES-GCM" }, false, ["encrypt"]
    );
    
    const encrypted = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv }, cryptoKey, encoded
    );
    
    const combined = new Uint8Array(iv.byteLength + encrypted.byteLength);
    combined.set(iv);
    combined.set(new Uint8Array(encrypted), iv.byteLength);
    
    return Array.from(combined).map(b => b.toString(16).padStart(2, '0')).join('');
}

sendButton.addEventListener('click', sendData);
</script>
</body>
</html>
