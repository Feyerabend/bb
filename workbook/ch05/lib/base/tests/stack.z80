        ORG     0100h       ; Start at 0x100

; Test stack operations (PUSH/POP)

START:  LD      SP, 0FFFFh  ; Initialize stack pointer
        
        ; Push some values
        LD      BC, 1234h
        LD      DE, 5678h
        PUSH    BC
        PUSH    DE
        
        ; Corrupt registers
        LD      BC, 0000h
        LD      DE, 0000h
        
        ; Pop back
        POP     DE          ; Should restore 5678h
        POP     BC          ; Should restore 1234h
        
        ; Check BC = 1234h by printing digits
        LD      A, B        ; A = 12h
        CALL    PRINTHEX
        LD      A, C        ; A = 34h
        CALL    PRINTHEX
        
        LD      A, ' '
        OUT     (2), A
        
        ; Check DE = 5678h
        LD      A, D        ; A = 56h
        CALL    PRINTHEX
        LD      A, E        ; A = 78h
        CALL    PRINTHEX
        
        LD      A, 0Ah      ; Newline
        OUT     (2), A
        
        JP      0000h       ; Halt

; Print A as two hex digits
PRINTHEX:
        PUSH    AF          ; Save A
        ; Print high nibble
        RRCA
        RRCA
        RRCA
        RRCA
        AND     0Fh
        ADD     A, 30h      ; Convert to ASCII
        CP      3Ah         ; > '9'?
        JP      C, SKIP1
        ADD     A, 7        ; Adjust for A-F
SKIP1:  OUT     (2), A
        
        ; Print low nibble
        POP     AF
        AND     0Fh
        ADD     A, 30h
        CP      3Ah
        JP      C, SKIP2
        ADD     A, 7
SKIP2:  OUT     (2), A
        RET

        END
