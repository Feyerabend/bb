<!DOCTYPE html>
<html>
<head>
    <title>UMAP Viewer</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #fileInput { margin-bottom: 10px; }
        canvas { border: 1px solid #ccc; }
    </style>
</head>
<body>
    <input type="file" id="fileInput" accept=".json">
    <script>
        let points = [];

        function setup() {
            createCanvas(500, 500);
            background(255);
            noLoop(); // Draw only when data is loaded

            // Handle file input
            let fileInput = document.getElementById('fileInput');
            fileInput.addEventListener('change', (event) => {
                let file = event.target.files[0];
                if (file) {
                    let reader = new FileReader();
                    reader.onload = (e) => {
                        points = JSON.parse(e.target.result).points;
                        redraw(); // Trigger draw with new data
                    };
                    reader.readAsText(file);
                }
            });
        }

        function draw() {
            if (points.length === 0) {
                background(255);
                textSize(16);
                fill(0);
                text("Upload umap_data.json to visualize", 10, 30);
                return;
            }

            // Normalize Y coordinates to canvas
            let y1 = points.map(p => p.y[0]);
            let y2 = points.map(p => p.y[1]);
            let minY1 = Math.min(...y1), maxY1 = Math.max(...y1);
            let minY2 = Math.min(...y2), maxY2 = Math.max(...y2);
            let scale = 400; // Plotting area
            let offset = 50; // Margin

            // Colors for labels (0: red, 1: green, 2: blue)
            let colors = [
                [255, 0, 0],
                [0, 255, 0],
                [0, 0, 255]
            ];

            // Draw points
            background(255);
            for (let p of points) {
                let x = map(p.y[0], minY1, maxY1, offset, offset + scale);
                let y = map(p.y[1], minY2, maxY2, offset, offset + scale);
                fill(colors[p.label]);
                noStroke();
                circle(x, y, 6);
            }

            // Add title
            textSize(16);
            fill(0);
            text("UMAP Projection", 10, 30);
        }
    </script>
</body>
</html>